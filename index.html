<!DOCTYPE>
<html>

<head>
  <title>Tri-Peaks</title>
</head>

<body>
  
  

  <!--this div contains all of the locations and id numbers of the playfield-->
  <div id = "divfield">
  <!--first row -->
  <IMG STYLE="position:absolute; TOP:50px; LEFT:150px;" SRC="images/BackA.png"
    id = "1" onClick="onClicktest('1')">
  <IMG STYLE="position:absolute; TOP:50px; LEFT:400px;" SRC="images/BackA.png"
    id = "2" onClick="onClicktest('2')">
  <IMG STYLE="position:absolute; TOP:50px; LEFT:650px;" SRC="images/BackA.png"
    id = "3" onClick="onClicktest('3')">
  
  <!--second row-->
  <IMG STYLE="position:absolute; TOP:80px; LEFT:110px;" SRC="images/BackA.png"
    id = "4" onClick="onClicktest('4')">
  <IMG STYLE="position:absolute; TOP:80px; LEFT:190px;" SRC="images/BackA.png"
    id = "5" onClick="onClicktest('5')">
  <IMG STYLE="position:absolute; TOP:80px; LEFT:360px;" SRC="images/BackA.png"
    id = "6" onClick="onClicktest('6')">
  <IMG STYLE="position:absolute; TOP:80px; LEFT:440px;" SRC="images/BackA.png"
    id = "7" onClick="onClicktest('7')">
  <IMG STYLE="position:absolute; TOP:80px; LEFT:610px;" SRC="images/BackA.png"
    id = "8" onClick="onClicktest('8')">
  <IMG STYLE="position:absolute; TOP:80px; LEFT:690px;" SRC="images/BackA.png"
    id = "9" onClick="onClicktest('9')">

  <!--third row-->
  <IMG STYLE="position:absolute; TOP:110px; LEFT:70px;" SRC="images/BackA.png"
    id = "10" onClick="onClicktest('10')">
  <IMG STYLE="position:absolute; TOP:110px; LEFT:150px;" SRC="images/BackA.png"
    id = "11" onClick="onClicktest('11')">
  <IMG STYLE="position:absolute; TOP:110px; LEFT:230px;" SRC="images/BackA.png"
    id = "12" onClick="onClicktest('12')">
  <IMG STYLE="position:absolute; TOP:110px; LEFT:320px;" SRC="images/BackA.png"
    id = "13" onClick="onClicktest('13')">
  <IMG STYLE="position:absolute; TOP:110px; LEFT:400px;" SRC="images/BackA.png"
    id = "14" onClick="onClicktest('14')">
  <IMG STYLE="position:absolute; TOP:110px; LEFT:480px;" SRC="images/BackA.png"
    id = "15" onClick="onClicktest('15')">
  <IMG STYLE="position:absolute; TOP:110px; LEFT:570px;" SRC="images/BackA.png"
    id = "16" onClick="onClicktest('16')">
  <IMG STYLE="position:absolute; TOP:110px; LEFT:650px;" SRC="images/BackA.png"
    id = "17" onClick="onClicktest('17')">
  <IMG STYLE="position:absolute; TOP:110px; LEFT:730px;" SRC="images/BackA.png"
    id = "18" onClick="onClicktest('18')">

  <!--fourth row-->
  <IMG STYLE="position:absolute; TOP:140px; LEFT:30px;" SRC="images/BackA.png"
    id = "19" onClick="onClicktest('19')">
  <IMG STYLE="position:absolute; TOP:140px; LEFT:110px;" SRC="images/BackA.png"
    id = "20" onClick="onClicktest('20')">
  <IMG STYLE="position:absolute; TOP:140px; LEFT:190px;" SRC="images/BackA.png"
    id = "21" onClick="onClicktest('21')">
  <IMG STYLE="position:absolute; TOP:140px; LEFT:275px;" SRC="images/BackA.png"
    id = "22" onClick="onClicktest('22')">
  <IMG STYLE="position:absolute; TOP:140px; LEFT:360px;" SRC="images/BackA.png"
    id = "23" onClick="onClicktest('23')">
  <IMG STYLE="position:absolute; TOP:140px; LEFT:440px;" SRC="images/BackA.png"
    id = "24" onClick="onClicktest('24')">
  <IMG STYLE="position:absolute; TOP:140px; LEFT:525px;" SRC="images/BackA.png"
    id = "25" onClick="onClicktest('25')">
  <IMG STYLE="position:absolute; TOP:140px; LEFT:610px;" SRC="images/BackA.png"
    id = "26" onClick="onClicktest('26')">
  <IMG STYLE="position:absolute; TOP:140px; LEFT:690px;" SRC="images/BackA.png"
    id = "27" onClick="onClicktest('27')">
  <IMG STYLE="position:absolute; TOP:140px; LEFT:770px;" SRC="images/BackA.png"
    id = "28" onClick="onClicktest('28')">

  <!--playdeck and active card-->
  <IMG STYLE="position:absolute; TOP:300px; LEFT:100px;" SRC="images/BackA.png"
    id = "29" onClick="nextactive()">
  <IMG STYLE="position:absolute; TOP:300px; LEFT:200px;" SRC="images/BackA.png"
    id = "30">
  </div>

  <button id="StartGame" onClick="startGame()">Start Game</button>
 
  <button id="NewGame" onClick="newGame()">New Game</button>
 
  <button id="RetryCurrentGame">Retry Current Game</button>
 
  <p STYLE="position:absolute; TOP:0px; LEFT:400px;" id="timer_p">Time: 150</p>
 
  <p STYLE="position:absolute; TOP:0px; LEFT:500px;" id="score_p">Score: 20000</p>


  <script>
    //variable for counting cards left in playing hand
    var handcount = 23;  
    var time = 150;
    var matchcount = 0;
    var score = 20000;
    
    //creating the initial deck
    var deck = [];
    for(var i = 0, j = 1; i<=51; i++, j++)
    {
      deck[i] = j;
    }
    
    //shuffling the initial deck
    shuffle(deck);


    //pulling the last 28 cards off of the deck after
    //it has been shuffled for the cards on the field    
    var playfield = [];
    for(var i = 0, j = 51; i<28; i++, j--)
    {
      playfield[i] = deck[j]
    }
    

    //taking the remaining cards out of the deck
    //and placing them in the playing hand of cards
    var hand = [];
    for(var i = 0, j = 23; i<25; i++, j--)
    {
      hand[i] = deck[j]
    }

 
    //function to shuffle the initial deck of 
    //cards after it is created
    function shuffle(array) 
    {
      var index = array.length, temp, randomindex;

      while (0 !== index) 
      {
        randomindex = Math.floor(Math.random() * index);
        index -= 1;
  
        temp = array[index];
        array[index] = array[randomindex];
        array[randomindex] = temp;
      }
      
       return array;
     } 


    //----work in progress----
    //fuction so that when you click on a card it checks
    //to see if it is a valid move and if so then plays the current
    //card onto the active card pile then removes the current
    //card from the playfield
    function onClicktest(id)
    {
      
      var index = (document.getElementById(id).src);
      index = index.substring(index.lastIndexOf("/")+5,index.lastIndexOf("."));
      console.log(index);
      var activeindex = (document.getElementById(30).src);
      activeindex = activeindex.substring(activeindex.lastIndexOf("/")+5,
        activeindex.lastIndexOf("."));
            
      var currentcard = playfield[id-1];      

      index %= 13;
      activeindex %= 13;
       
      if(index+1 == activeindex || index-1 == activeindex ||
         (index == 0 && activeindex == 12) || (index == 12 && activeindex == 0))
      {
        document.getElementById(30).src = "images/Card" + currentcard + ".png";
      
        //this is to remove a card from the field once it has been 
        //moved to the active card position
        var parent = document.getElementById("divfield");
        var child = document.getElementById(id); 
        
        parent.removeChild(child);

        matchcount++;

        if(matchcount == 1)
		    {
  			  // first card match is worth 100 points.  Add 100 points to score and display.
  			  score = score + 100;
  			  document.getElementById("score_p").innerHTML = "Score: " + score;
        }
  		  else
  		  {
  			  // matchcount > 1. Add 200 points to score and display
  		  	score = score + 200;
  		  	document.getElementById("score_p").innerHTML = "Score: " + score;
  		  }

      if(matchcount == 28)
      {
        alert("You Won! Your Score is: " + score);
           
      } 
        
      }

      //this nested if else statement is to flip a card when there are
      //no longer cards covering it
      //----third row----
      if(id == 18)
      {
        if(document.getElementById(28) == null && document.getElementById(27) == null)
        {
         document.getElementById(18).src = "images/Card" + playfield[17] + ".png";
         
        }
      }
      else if(id == 17)
      {
        if(document.getElementById(27) == null && document.getElementById(26) == null)
        {
          document.getElementById(17).src = "images/Card" + playfield[16] + ".png";
         
        }
      }
      else if(id == 16)
      {
        if(document.getElementById(26) == null && document.getElementById(25) == null)
        {
          document.getElementById(16).src = "images/Card" + playfield[15] + ".png";
          
        }
      }
      else if(id == 15)
      {
        if(document.getElementById(25) == null && document.getElementById(24) == null)
        {        
          document.getElementById(15).src = "images/Card" + playfield[14] + ".png";
          
        }      
      }
      else if(id == 14)
      {
        if(document.getElementById(24) == null && document.getElementById(23) == null)
        {
          document.getElementById(14).src = "images/Card" + playfield[13] + ".png";
          
        }
      }
      else if(id == 13)
      {
        if(document.getElementById(23) == null && document.getElementById(22) == null)
        {  
          document.getElementById(13).src = "images/Card" + playfield[12] + ".png";
                
        }
      }
      else if(id == 12)
      {
        if(document.getElementById(22) == null && document.getElementById(21) == null)
        {
          document.getElementById(12).src = "images/Card" + playfield[11] + ".png";
          
        }
      }
      else if(id == 11)
      {
        if(document.getElementById(21) == null && document.getElementById(20) == null)
        {
          document.getElementById(11).src = "images/Card" + playfield[10] + ".png";
             
        }
      }
      else if(id == 10)
      {  
        if(document.getElementById(20) == null && document.getElementById(19) == null)
        {
          document.getElementById(10).src = "images/Card" + playfield[9] + ".png";
          
        }
      } 
      //----second row----     
      else if(id == 9)
      {
        if(document.getElementById(18) == null && document.getElementById(17) == null)
        {
          document.getElementById(9).src = "images/Card" + playfield[8] + ".png";
          
        }
      }
      else if(id == 8)
      {
        if(document.getElementById(17) == null && document.getElementById(16) == null)
        {
          document.getElementById(8).src = "images/Card" + playfield[7] + ".png";
          
        }
      }
      else if(id == 7)
      {
        if(document.getElementById(15) == null && document.getElementById(14) == null)
        {
          document.getElementById(7).src = "images/Card" + playfield[6] + ".png";
          
        }
      }
      else if(id == 6)
      {
        if(document.getElementById(14) == null && document.getElementById(13) == null)
        {
          document.getElementById(6).src = "images/Card" + playfield[5] + ".png";
        }  
      }
      else if(id == 5)
      {
        if(document.getElementById(12) == null && document.getElementById(11) == null)
        {
          document.getElementById(5).src = "images/Card" + playfield[4] + ".png";
          
        }
      }
      else if(id == 4)
      {
        if(document.getElementById(11) == null && document.getElementById(10) == null)
        {
          document.getElementById(4).src = "images/Card" + playfield[3] + ".png";
          
        }
      }
      //----first row----      
      else if(id == 3)
      {
        if(document.getElementById(9) == null && document.getElementById(8) == null)
        {
          document.getElementById(3).src = "images/Card" + playfield[2] + ".png";
          
        }
      }
      else if(id == 2)
      {
        if(document.getElementById(7) == null && document.getElementById(6) == null)
        {
          document.getElementById(2).src = "images/Card" + playfield[1] + ".png";
          
        }
      }
      else if(id == 1)
      {
        if(document.getElementById(5) == null && document.getElementById(4) == null)
        {
          document.getElementById(1).src = "images/Card" + playfield[0] + ".png";
          
        }
      }

      
      

      
    }

    //test function to check if cards can be changed or manipulated
    function testfunction()
    {
      document.getElementById("divfield").innerHTML = "123";
  
    }


    

    //fuction to flip a card out of the play hand
    //onto the active card pile and check to see
    //if the play hand is out of card to signal a 
    //Game Over alert
    function nextactive()
    {
      document.getElementById(30).src = "images/Card" + hand[handcount] + ".png";
     
      handcount--;
      
      if(handcount == -2)
      {
        alert("Game Over");
      }
    }

    //function to start the game by "fliping" the
    //initial cards on the fourth row face up
    function deal()
    {
           

      document.getElementById(19).src = "images/Card" + playfield[18] + ".png";
      document.getElementById(20).src = "images/Card" + playfield[19] + ".png";
      document.getElementById(21).src = "images/Card" + playfield[20] + ".png";
      document.getElementById(22).src = "images/Card" + playfield[21] + ".png";
      document.getElementById(23).src = "images/Card" + playfield[22] + ".png";
      document.getElementById(24).src = "images/Card" + playfield[23] + ".png";
      document.getElementById(25).src = "images/Card" + playfield[24] + ".png";
      document.getElementById(26).src = "images/Card" + playfield[25] + ".png";
      document.getElementById(27).src = "images/Card" + playfield[26] + ".png";
      document.getElementById(28).src = "images/Card" + playfield[27] + ".png";

      
    }

    
    // Cameron:

    // function to refresh the webpage
	  function refreshPage() {
		  location.reload();
	  }

    function startGame(){
		hideStartButton();
		var myTimer = setInterval(timer, 1000);
		deal();
		nextactive();
	}
	
	  // function to hide the start button after clicked.
	  function hideStartButton()
  	{
  		document.getElementById('StartGame').style.visibility = 'hidden';
  	}
	
	  function timer()
  	{
	  	time--;
  		document.getElementById("timer_p").innerHTML = "Time: " + time;
		
  		// deduct 200 points for each extra second
  		// over the given 2 minutes and 30 seconds.
		
  		score = score - 200;
		
  		document.getElementById("score_p").innerHTML = "Score: " + score;
		
  	}
	
	
  	function newGame() {
  		location.reload();
  	}
	
	  // updates the current score (according to the time)
	  function updateScore()
	  {
		  document.getElementByID("timer_p").innerHTML = "Time: " + time;
		  document.getElementById("score_p").innerHTML = "Score: " + score;
  	}

    

    


  </script>
  

</body>

</html>
